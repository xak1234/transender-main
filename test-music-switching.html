<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Track Switching Test</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #000;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        
        .test-container {
            text-align: center;
            padding: 20px;
        }
        
        .control-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(0, 0, 0, 0.7);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
            position: relative;
            margin: 10px;
        }

        .control-icon:hover {
            transform: scale(1.1);
            border-color: rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.4);
        }

        .control-icon.active {
            background: rgba(0, 255, 204, 0.3);
            border-color: #00ffcc;
            box-shadow: 0 0 20px rgba(0, 255, 204, 0.6);
        }

        .control-icon i {
            font-size: 24px;
            color: #fff;
        }
        
        #musicTrackIndicator {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #00ffcc;
            color: #000;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            display: none;
        }
        
        .status {
            margin-top: 20px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Music Track Switching Test</h1>
        <p>Click the music icon to test track switching functionality</p>
        
        <div class="control-icon" id="musicIcon" title="Toggle Music - Click to start playlist">
            <i class="fas fa-music"></i>
            <span id="musicTrackIndicator">1</span>
        </div>
        
        <div class="status" id="status">
            Music: Stopped | Track: None
        </div>
        
        <div class="status">
            <h3>Available Tracks:</h3>
            <ul id="trackList" style="text-align: left; display: inline-block;">
                <li>1. oxy.mp3</li>
                <li>2. ard.mp3</li>
                <li>3. bag.mp3</li>
                <li>4. fonker.mp3</li>
                <li>5. anub.mp3</li>
                <li>6. 4m.mp3</li>
            </ul>
        </div>
    </div>

    <script>
        // Test music functionality
        let musicAudio = null;
        let musicPlaying = false;
        let currentMusicIndex = 0;
        let musicPlaylist = ['oxy.mp3', 'ard.mp3', 'bag.mp3', 'fonker.mp3', 'anub.mp3', '4m.mp3'];
        
        const musicIcon = document.getElementById('musicIcon');
        const status = document.getElementById('status');
        
        function updateTrackIndicator() {
            const trackIndicator = document.getElementById('musicTrackIndicator');
            if (trackIndicator) {
                if (musicPlaying) {
                    trackIndicator.textContent = currentMusicIndex + 1;
                    trackIndicator.style.display = 'flex';
                    // Update tooltip to show current track
                    const currentSong = musicPlaylist[currentMusicIndex];
                    musicIcon.title = `Current Track: ${currentSong} (${currentMusicIndex + 1}/${musicPlaylist.length}) - Click to switch tracks`;
                } else {
                    trackIndicator.style.display = 'none';
                    // Reset tooltip
                    musicIcon.title = 'Toggle Music - Click to start playlist';
                }
            }
        }
        
        function updateStatus() {
            if (musicPlaying) {
                const currentSong = musicPlaylist[currentMusicIndex];
                status.textContent = `Music: Playing | Track: ${currentSong} (${currentMusicIndex + 1}/${musicPlaylist.length})`;
            } else {
                status.textContent = 'Music: Stopped | Track: None';
            }
        }
        
        function playNextSong() {
            return new Promise((resolve, reject) => {
                if (!musicPlaying) {
                    resolve();
                    return;
                }
                
                // Create new audio element for current song
                if (musicAudio) {
                    musicAudio.pause();
                    musicAudio.removeEventListener('ended', handleSongEnd);
                    musicAudio.removeEventListener('error', handleSongError);
                    musicAudio = null;
                }
                
                const currentSong = musicPlaylist[currentMusicIndex];
                console.log(`Attempting to play: ${currentSong} (${currentMusicIndex + 1}/${musicPlaylist.length})`);
                
                musicAudio = new Audio(currentSong);
                musicAudio.volume = 0.3;
                musicAudio.preload = 'auto';
                
                // Add event listeners
                musicAudio.addEventListener('ended', handleSongEnd);
                musicAudio.addEventListener('error', () => {
                    reject(new Error(`Failed to load ${currentSong}`));
                    handleSongError();
                });
                
                // Play the current song
                musicAudio.play().then(() => {
                    console.log(`Successfully playing: ${currentSong}`);
                    updateTrackIndicator();
                    updateStatus();
                    resolve();
                }).catch(error => {
                    console.error(`Error playing ${currentSong}:`, error);
                    reject(error);
                    handleSongError();
                });
            });
        }
        
        function handleSongEnd() {
            console.log(`Song ended: ${musicPlaylist[currentMusicIndex]}`);
            if (musicPlaying) {
                // Move to next song in playlist
                currentMusicIndex = (currentMusicIndex + 1) % musicPlaylist.length;
                console.log(`Moving to next song: ${musicPlaylist[currentMusicIndex]}`);
                setTimeout(() => {
                    playNextSong();
                    updateTrackIndicator();
                    updateStatus();
                }, 500);
            }
        }
        
        function handleSongError() {
            console.error(`Error with song: ${musicPlaylist[currentMusicIndex]}`);
            if (musicPlaying) {
                // Try the next song
                currentMusicIndex = (currentMusicIndex + 1) % musicPlaylist.length;
                console.log(`Skipping to next song: ${musicPlaylist[currentMusicIndex]}`);
                setTimeout(() => {
                    playNextSong();
                    updateTrackIndicator();
                    updateStatus();
                }, 1000);
            }
        }
        
        // Music Icon - Toggle music and cycle through tracks
        musicIcon.addEventListener('click', async () => {
            console.log('Music icon clicked - cycling through tracks');
            
            if (musicPlaying) {
                // If music is playing, switch to next track
                currentMusicIndex = (currentMusicIndex + 1) % musicPlaylist.length;
                console.log(`Switching to track ${currentMusicIndex + 1}/${musicPlaylist.length}: ${musicPlaylist[currentMusicIndex]}`);
                
                // Stop current song and play next one
                if (musicAudio) {
                    musicAudio.pause();
                    musicAudio.removeEventListener('ended', handleSongEnd);
                    musicAudio.removeEventListener('error', handleSongError);
                    musicAudio = null;
                }
                
                try {
                    await playNextSong();
                    updateTrackIndicator();
                    updateStatus();
                } catch (error) {
                    console.error('Failed to switch to next track:', error);
                    // If switching fails, try the next track
                    currentMusicIndex = (currentMusicIndex + 1) % musicPlaylist.length;
                    setTimeout(() => {
                        playNextSong();
                        updateTrackIndicator();
                        updateStatus();
                    }, 500);
                }
            } else {
                // Start music playlist from current index
                try {
                    musicPlaying = true;
                    musicIcon.classList.add('active');
                    
                    console.log(`Starting music playlist at track ${currentMusicIndex + 1}/${musicPlaylist.length}: ${musicPlaylist[currentMusicIndex]}`);
                    
                    await playNextSong();
                    updateTrackIndicator();
                    updateStatus();
                } catch (error) {
                    console.error('Failed to start music:', error);
                    musicPlaying = false;
                    musicIcon.classList.remove('active');
                    updateTrackIndicator();
                    updateStatus();
                    alert('Could not start music. Please check browser permissions for audio playback.');
                }
            }
        });
        
        // Initialize
        updateStatus();
    </script>
</body>
</html> 