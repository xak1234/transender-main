rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Leaderboard collection rules
    match /leaderboard/{document} {
      // Allow reading leaderboard data (public)
      allow read: if true;
      
      // Allow anonymous writes for score submission (no auth required)
      allow create: if request.resource.data.username is string
        && request.resource.data.score is number
        && request.resource.data.score > 0
        && request.resource.data.username.size() > 0
        && request.resource.data.username.size() <= 50
        && request.resource.data.timestamp is timestamp;
      
      // Allow updates only by the original user or admin (if authenticated)
      allow update: if request.auth != null 
        && (request.auth.uid == resource.data.userId || request.auth.token.admin == true);
      
      // Allow deletion only by admin
      allow delete: if request.auth != null && request.auth.token.admin == true;
    }
    
    // Block access to all other collections
    match /{document=**} {
      allow read, write: if false;
    }
  }
} 